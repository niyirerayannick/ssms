{% extends 'base.html' %}
{% load custom_filters %}

{% block title %}{{ school.name }} - School Profile - SIMS{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto animate-fade-in">
    <!-- Header Section -->
    <div class="bg-gradient-to-b from-emerald-900 via-teal-900 to-emerald-800 rounded-xl shadow-lg p-6 md:p-8 text-white mb-6">
        <div class="flex justify-between items-start mb-4">
            <div>
                <h1 class="text-4xl font-bold mb-2">{{ school.name }}</h1>
                <p class="text-blue-100 text-lg">{{ school.district.name|default:"N/A" }}, {{ school.province.name|default:"N/A" }}</p>
            </div>
            <div class="flex space-x-3">
                <a href="{% url 'core:school_edit' school.pk %}" class="bg-white text-blue-600 hover:bg-gray-100 px-4 py-2 rounded-lg font-semibold transition">
                    Edit School
                </a>
                <a href="{% url 'core:school_list' %}" class="bg-blue-500 hover:bg-blue-400 px-4 py-2 rounded-lg font-semibold transition">
                    Back to Schools
                </a>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Left Column: School Information -->
        <div class="lg:col-span-2 space-y-6">
            <!-- Headteacher Information Card -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center border-b pb-3">
                    <svg class="w-6 h-6 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                    Headteacher Information
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <p class="text-sm text-gray-600 font-medium mb-1">Name</p>
                        <p class="text-lg font-semibold text-gray-800">{{ school.headteacher_name|default:"Not specified" }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600 font-medium mb-1">Mobile Number</p>
                        <p class="text-lg font-semibold text-gray-800">
                            {% if school.headteacher_mobile %}
                                <a href="tel:{{ school.headteacher_mobile }}" class="text-blue-600 hover:underline">{{ school.headteacher_mobile }}</a>
                            {% else %}
                                <span class="text-gray-400">Not provided</span>
                            {% endif %}
                        </p>
                    </div>
                    <div class="md:col-span-2">
                        <p class="text-sm text-gray-600 font-medium mb-1">Email Address</p>
                        <p class="text-lg font-semibold text-gray-800">
                            {% if school.headteacher_email %}
                                <a href="mailto:{{ school.headteacher_email }}" class="text-blue-600 hover:underline">{{ school.headteacher_email }}</a>
                            {% else %}
                                <span class="text-gray-400">Not provided</span>
                            {% endif %}
                        </p>
                    </div>
                </div>
            </div>

            <!-- Banking Information Card -->
            <div class="bg-gradient-to-br from-yellow-50 to-amber-50 border-2 border-yellow-200 rounded-xl p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Bank Account Information
                </h2>
                {% if school.bank_name %}
                <div class="space-y-4">
                    <div>
                        <p class="text-sm text-gray-600 font-medium mb-1">Bank Name</p>
                        <p class="text-xl font-bold text-gray-800">{{ school.bank_name }}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600 font-medium mb-1">Account Holder Name</p>
                        <p class="text-lg font-semibold text-gray-800">{{ school.bank_account_name }}</p>
                    </div>
                    <div class="bg-white rounded-lg p-4 border-l-4 border-yellow-500">
                        <p class="text-sm text-gray-600 font-medium mb-1">Account Number</p>
                        <p class="text-lg font-mono font-bold text-gray-800">{{ school.bank_account_number }}</p>
                    </div>
                </div>
                {% else %}
                <p class="text-gray-600 italic">No banking information provided</p>
                {% endif %}
            </div>

            <!-- Fee Information Card -->
            <div class="bg-gradient-to-br from-green-50 to-emerald-50 border-2 border-green-200 rounded-xl p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Fee Information
                </h2>
                <div class="text-center py-4">
                    <p class="text-sm text-gray-600 font-medium mb-2">Standard Fee per Student</p>
                    <p class="text-5xl font-bold text-green-600">{{ school.fee_amount|compact_number }}</p>
                    <p class="text-lg text-gray-600 mt-2">RWF</p>
                </div>
            </div>

            <!-- Location Information Card -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h2 class="text-2xl font-bold text-gray-800 mb-4 flex items-center border-b pb-3">
                    <svg class="w-6 h-6 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                    </svg>
                    Location Information (Rwanda Administrative Structure)
                </h2>
                <div class="space-y-3">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-sm text-gray-600 font-medium mb-1">Province</p>
                            <p class="text-lg font-semibold text-gray-800">{{ school.province.name|default:"Not specified" }}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600 font-medium mb-1">District</p>
                            <p class="text-lg font-semibold text-gray-800">{{ school.district.name|default:"Not specified" }}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600 font-medium mb-1">Sector</p>
                            <p class="text-lg font-semibold text-gray-800">{{ school.sector.name|default:"Not specified" }}</p>
                        </div>
                        <div>
                            <p class="text-sm text-gray-600 font-medium mb-1">Cell</p>
                            <p class="text-lg font-semibold text-gray-800">{{ school.cell.name|default:"Not specified" }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Students & Stats -->
        <div class="space-y-6">
            <!-- School Statistics -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4">School Statistics</h3>
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                        <span class="text-gray-700 font-medium">Total Students</span>
                        <span class="text-2xl font-bold text-blue-600">{{ student_count|compact_number }}</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                        <span class="text-gray-700 font-medium">Standard Fee</span>
                        <span class="text-xl font-bold text-green-600">{{ school.fee_amount|compact_number }} RWF</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-orange-50 rounded-lg">
                        <span class="text-gray-700 font-medium">Added</span>
                        <span class="text-sm font-semibold text-orange-600">{{ school.created_at|date:"M d, Y" }}</span>
                    </div>
                    <div class="flex items-center justify-between p-3 bg-indigo-50 rounded-lg">
                        <span class="text-gray-700 font-medium">Last Updated</span>
                        <span class="text-sm font-semibold text-indigo-600">{{ school.updated_at|date:"M d, Y" }}</span>
                    </div>
                </div>
            </div>

            <!-- Students Section -->
            <div class="bg-white rounded-xl shadow-md p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                    <svg class="w-5 h-5 mr-2 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 12H9m6 0H9m6 0H9m6 0H9M9 8h6"/>
                    </svg>
                    Students ({{ student_count|compact_number }})
                </h3>
                
                {% if students %}
                    <div class="space-y-3 max-h-96 overflow-y-auto">
                        {% for student in students %}
                        <div class="p-4 border border-gray-200 rounded-lg hover:border-blue-400 transition">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <p class="font-semibold text-gray-800">
                                        <a href="{% url 'students:student_detail' student.pk %}" class="text-blue-600 hover:underline">
                                            {{ student.full_name }}
                                        </a>
                                    </p>
                                    <p class="text-xs text-gray-600">
                                        {% if student.family %}
                                            <a href="{% url 'families:family_detail' student.family.pk %}" class="text-blue-500 hover:underline">
                                                Family: {{ student.family.head_of_family }}
                                            </a>
                                        {% else %}
                                            <span class="text-gray-400">No family linked</span>
                                        {% endif %}
                                    </p>
                                </div>
                                <span class="text-xs font-semibold {% if student.is_active %}text-green-600 bg-green-100{% else %}text-gray-600 bg-gray-100{% endif %} px-2 py-1 rounded">
                                    {% if student.is_active %}Active{% else %}Inactive{% endif %}
                                </span>
                            </div>
                            <div class="text-xs text-gray-600 space-y-1">
                                <p><span class="font-medium">Class:</span> {{ student.class_level }}</p>
                                <p><span class="font-medium">Status:</span> {{ student.get_enrollment_status_display }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                {% else %}
                <div class="text-center py-8">
                    <svg class="w-16 h-16 mx-auto text-gray-300 mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                    <p class="text-gray-600 font-medium">No students enrolled yet</p>
                    <a href="{% url 'students:student_create' %}" class="text-blue-600 hover:text-blue-800 text-sm font-semibold mt-2 inline-block">
                        Enroll First Student â†’
                    </a>
                </div>
                {% endif %}
            </div>

            <!-- Quick Actions -->
            <div class="bg-blue-50 border-l-4 border-blue-500 rounded-lg p-4">
                <h4 class="font-bold text-gray-800 mb-3">Quick Actions</h4>
                <div class="space-y-2">
                    <a href="{% url 'students:student_create' %}" class="block w-full text-center px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded font-semibold text-sm transition">
                        + Add Student
                    </a>
                    <a href="{% url 'core:school_edit' school.pk %}" class="block w-full text-center px-3 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded font-semibold text-sm transition">
                        Edit Details
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
